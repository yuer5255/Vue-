# 缓存决策

前面我们较为详细地介绍了浏览器 HTTP缓存配置与验证细节，下面思考一下如何应用 HTTP缓存技术来提升网站的性能。

假设在不考虑客户端缓存容量与服务器算力的理想情况下，我们当然希望客户端浏览器上的缓存触发发率尽可能高，留存时间尽可能长，同时还要 ETag 实现当资源更新时进行高效的重新验证

但实际情况往往是容量与算力都有限，因此就就需要制定合适的缓存策略，来利用有限的资源达到最优的性能效果。明确能力的边界，在边界内做到最好。

### 缓存决策树

在面对一个具体的缓存需求时，到底该如何制定缓存策略呢? 我们可以参照图所示的决策树来逐步确定对一个资源具体的缓存策略。

![](<../.gitbook/assets/image (6).png>)



* ⾸先根据资源内容的属性判断是否需要使⽤缓存，如果不希望对该资源开启缓存（⽐如涉及⽤户的⼀些敏感信息），则可直接设置 `cache-control` 的属性值为 `no-store` 来禁⽌任何缓存策略，这样请求和响应的信息就都不会被存储在对⽅及中间代理的磁盘系统上。
* 如果希望使⽤缓存，那么接下来就需要确定对缓存有效性的判断是否要与服务器进⾏协商，若需要与服务器协商则可为 `cache-control` 字段增加 `no-cache` 属性值，来强制启⽤协商缓存。
* 否则接下来考虑是否允许中间代理服务器缓存该资源，可通过为 `cache-control` 字段添加 `private` 或 `public` 来进⾏控制
* 如果之前未设置 `no-cache` 启⽤协商缓存，那么接下来可设置强制缓存的过期时间，即为 `cache-control` 字段配置 `max-age=…` 的属 性值
* 最后如果启⽤了协商缓存，则可进⼀步设置请求资源的 `last-modified` 和 `ETag` 实体标签等参 数



### 缓存设置注意事项

* 拆分源码，分包加载，这样内容更改，仅需拉取发生修改的模块代码包，如果是采用 webpack，可以使用 `splitChunks` 进行分块打包，或者使用动态加载，比如 `import()` 函数
* 预估资源的缓存时效，根据文件内容，设置不同的缓存过期时间
* 控制中间代理的缓存，涉及用户隐私的不要采取中间代理
* 避免网址的冗余，相同资源采用同一个网址
