# 协商缓存

{% hint style="info" %}
协商缓存就是强制缓存失效后，浏览器携带缓存标识向服务器发起请求，由服务器根据缓存标识决定是否使用缓存的过程
{% endhint %}

![](<../.gitbook/assets/image (4).png>)

浏览器第一次请求的时候，若服务器使用了协商缓存学的策略，则它会返回资源和资源标识，并且浏览器将返回的资源存储到本地缓存。

![](<../.gitbook/assets/image (9) (1).png>)

当浏览器再次请求该资源时，浏览器向服务器发送请求和资源标识，服务器这时就会去判断当前请求的资源浏览器本次缓存的版本跟服务器里面资源最新的版本是否一致:

* 如果版本一致，服务器返回304状态码，重定向让浏览器直接在本地缓存里拿资源; ·
* 如果版本不一致，服务器返回200状态码、最新的资源以及新的资源标识，浏览器更新本地缓存。&#x20;

### 资源标识:&#x20;

* **Last-Modified/lf-Modified-Since**:指资源上一次修改的时间&#x20;
* **Etag/If-None-Match**:资源对应的唯一字符串&#x20;

### 优先级

`Etag` > `Last-Modified`

``

### 区别

* 服务器会为每个资源生成一个唯一的标识字符串，只要文件内容不同，它们对应的Etag就是不同的;
* `If-Modified`-`Since` 能检查到的精度是**秒级**的，某些服务器不能精确的得到文件的最后修改时间，我们编辑了文件，但文件的内容没有改变。因为服务器是根据文件的最后修改时间来判断的，导致重新请求。
* 所以才出现了`Etag`，`Etag`对服务器也有性能损耗
